<template>
  <v-expansion-panels>
    <v-expansion-panel>
      <v-expansion-panel-title :color="status_color[machine.status]">
        {{ machine.ip }} <br>
        {{ machine.name }}
      </v-expansion-panel-title>
      <v-expansion-panel-text>
        <v-overlay
          v-model="overlay"
          contained
          class=""
        >
        <v-card style="">
          <v-textarea size="auto" v-model="overlay_text">
          </v-textarea>
      </v-card>
        </v-overlay>
        <v-row>
          <v-col @click="change_status('TODO')"><v-tooltip activator="parent" location="top">Set as
              TODO</v-tooltip><v-icon color="" icon="mdi-information-outline"></v-icon></v-col>
          <v-col @click="change_status('Checked')"><v-tooltip activator="parent" location="top">Set as
              Checked</v-tooltip><v-icon color="green" icon="mdi-information"></v-icon></v-col>
          <v-col @click="change_status('Initial Access')"><v-tooltip activator="parent" location="top">Set as Initial
              Access</v-tooltip><v-icon color="orange" icon="mdi-information"></v-icon></v-col>
          <v-col @click="change_status('Rooted')"><v-tooltip activator="parent" location="top">set as
              Rooted</v-tooltip><v-icon color="red" icon="mdi-information"></v-icon></v-col>
        </v-row>
        <v-list lines="one">
          <v-list-item v-for="port in machine.ports" :key="port">
            <v-list-item-title>
              <v-row>
                <v-col>
                  {{ port.number }}: {{ port.name }}s
                </v-col>
                <v-col> <v-menu>
                    <template v-slot:activator="{ props }">
                      <v-btn  size="x-small"  :color="status_port_color[port.status]" dark v-bind="props">
                        <v-icon icon="mdi-list-status"></v-icon>
                      </v-btn>
                    </template>
                    <v-list>
                      <v-list-item @click="change_port_status(port, n)" v-for="n in ['TODO', 'Safe', 'Vulnerable']"
                        :key="n">
                        <v-list-item-title>{{ n }}</v-list-item-title>
                      </v-list-item>
                    </v-list>
                  </v-menu></v-col>
                  <v-col> 
                      <v-btn size="x-small" dark v-bind="props"  @click="overlay = true; overlay_text = port.comment">
                        <v-icon icon="mdi-information-outline"></v-icon></v-btn>
                </v-col>
              </v-row>
            </v-list-item-title>
            <v-list-item-text>
            </v-list-item-text>
          </v-list-item>
        </v-list>
      </v-expansion-panel-text>
    </v-expansion-panel>
  </v-expansion-panels>
</template>


<script>
export default {
  props: {
    machine: Object
  },
  data: () => ({
    status_color: {
      TODO: 'white',
      Checked: 'green',
      'Initial Access': 'orange',
      Rooted: 'red'
    },
    status_port_color: {
      TODO: 'blue',
      Safe: 'green',
      Vulnerable: 'red'
    },
    overlay: false,
    overlay_text: ''
  }),
  methods: {
    change_status: function (status) {
      this.machine.status = status
    },
    change_port_status: function (port, status) {
      let i
      for (i in this.machine.ports) {
        if (this.machine.ports[i].number == port.number) {
          this.machine.ports[i].status = status
        }
      }
    }
  }
}
</script>

<style>
.v-expansion-panel-text__wrapper {
  padding: 0 !important;
}
</style>
